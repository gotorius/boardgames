<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>将棋</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@400;700&display=swap" rel="stylesheet">
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="firebase-config.js"></script>
</head>
<body>
    <div class="game-container">
        <header class="game-header">
            <a href="../index.html" class="home-link">← ホーム</a>
            <h1>将棋</h1>
            <div class="game-controls">
                <button id="new-game-btn" class="btn btn-primary">新しい対局</button>
                <button id="undo-btn" class="btn btn-secondary" disabled>待った</button>
                <button id="hint-btn" class="btn btn-secondary">ヒント</button>
            </div>
        </header>

        <!-- ゲーム情報パネル -->
        <div class="game-info-panel">
            <div class="player-info opponent-player">
                <div class="player-icon">☖</div>
                <div class="player-details">
                    <span class="player-name" id="opponent-name">後手（CPU）</span>
                    <span class="player-rank" id="opponent-rank"></span>
                </div>
                <div class="turn-indicator" id="opponent-turn"></div>
            </div>
            
            <div class="game-status">
                <div class="current-turn" id="current-turn">先手の番です</div>
                <div class="game-mode" id="game-mode">VS CPU（竹）</div>
                <div class="move-count">手数: <span id="move-count">0</span></div>
            </div>
            
            <div class="player-info my-player">
                <div class="turn-indicator" id="my-turn"></div>
                <div class="player-details">
                    <span class="player-name" id="my-name">先手（あなた）</span>
                    <span class="player-rank" id="my-rank"></span>
                </div>
                <div class="player-icon">☗</div>
            </div>
        </div>

        <main class="game-board-wrapper">
            <!-- 相手の持ち駒 -->
            <div class="captured-pieces opponent-captured" id="opponent-captured">
                <div class="captured-label">☖ 持ち駒</div>
                <div class="captured-list" id="opponent-captured-list"></div>
            </div>

            <!-- 将棋盤 -->
            <div class="board-container">
                <!-- 思考中インジケーター -->
                <div id="thinking-indicator" class="thinking-indicator hidden">
                    <div class="thinking-spinner"></div>
                    <span class="thinking-text">思考中...</span>
                </div>
                <div class="board-frame">
                    <!-- 筋（列）の表示 -->
                    <div class="board-labels cols">
                        <span>9</span><span>8</span><span>7</span><span>6</span><span>5</span><span>4</span><span>3</span><span>2</span><span>1</span>
                    </div>
                    <div class="board-with-rows">
                        <!-- 段（行）の表示 -->
                        <div class="board-labels rows">
                            <span>一</span><span>二</span><span>三</span><span>四</span><span>五</span><span>六</span><span>七</span><span>八</span><span>九</span>
                        </div>
                        <div class="board" id="board">
                            <!-- 9x9のマスがJavaScriptで生成される -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- 自分の持ち駒 -->
            <div class="captured-pieces my-captured" id="my-captured">
                <div class="captured-label">☗ 持ち駒</div>
                <div class="captured-list" id="my-captured-list"></div>
            </div>
        </main>

        <!-- モード選択モーダル -->
        <div id="mode-modal" class="modal">
            <div class="modal-content">
                <h2>対局モード選択</h2>
                <div class="mode-options">
                    <div class="mode-section">
                        <h3>CPU対戦</h3>
                        <div class="difficulty-options">
                            <button class="mode-btn shogi-btn" onclick="initGame('cpu', 'ume')">
                                <span class="mode-icon">🌸</span>
                                <span class="mode-name">梅</span>
                                <span class="mode-desc">初心者向け</span>
                            </button>
                            <button class="mode-btn shogi-btn" onclick="initGame('cpu', 'take')">
                                <span class="mode-icon">🎋</span>
                                <span class="mode-name">竹</span>
                                <span class="mode-desc">中級者向け</span>
                            </button>
                            <button class="mode-btn shogi-btn" onclick="initGame('cpu', 'matsu')">
                                <span class="mode-icon">🌲</span>
                                <span class="mode-name">松</span>
                                <span class="mode-desc">上級者向け</span>
                            </button>
                        </div>
                    </div>
                    <div class="mode-section">
                        <h3>詰将棋</h3>
                        <div class="tsume-options">
                            <button class="mode-btn shogi-btn" onclick="initGame('tsume', 1)">
                                <span class="mode-icon">①</span>
                                <span class="mode-name">一手詰</span>
                                <span class="mode-desc">入門編</span>
                            </button>
                            <button class="mode-btn shogi-btn" onclick="initGame('tsume', 3)">
                                <span class="mode-icon">③</span>
                                <span class="mode-name">三手詰</span>
                                <span class="mode-desc">初級編</span>
                            </button>
                            <button class="mode-btn shogi-btn" onclick="initGame('tsume', 5)">
                                <span class="mode-icon">⑤</span>
                                <span class="mode-name">五手詰</span>
                                <span class="mode-desc">中級編</span>
                            </button>
                        </div>
                    </div>
                    <div class="mode-section">
                        <h3>2人対戦</h3>
                        <div class="pvp-options">
                            <button class="mode-btn shogi-btn wide" onclick="initGame('pvp', null)">
                                <span class="mode-icon">👥</span>
                                <span class="mode-name">ローカル対戦</span>
                                <span class="mode-desc">同じ端末で2人対戦</span>
                            </button>
                        </div>
                    </div>
                    <div class="mode-section">
                        <h3>オンライン対戦</h3>
                        <div class="pvp-options">
                            <button class="mode-btn shogi-btn wide" onclick="showOnlineMatchModal()">
                                <span class="mode-icon">🌐</span>
                                <span class="mode-name">オンライン対戦</span>
                                <span class="mode-desc">インターネット経由で対戦</span>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="modal-buttons">
                    <a href="../index.html" class="btn btn-secondary">ホームに戻る</a>
                </div>
            </div>
        </div>

        <!-- オンラインマッチモーダル -->
        <div id="online-match-modal" class="modal hidden">
            <div class="modal-content">
                <h2>🌐 オンライン対戦</h2>
                <div class="online-match-options">
                    <button class="mode-btn shogi-btn wide" onclick="startMatchmaking()">
                        <span class="mode-icon">🔄</span>
                        <span class="mode-name">対戦相手を探す</span>
                        <span class="mode-desc">マッチメイキングで対戦相手を探します</span>
                    </button>
                    <div style="margin-top: 20px; padding: 15px; background: rgba(255,215,0,0.1); border-radius: 8px;">
                        <p style="font-size: 0.9rem; margin-bottom: 10px;">招待コード（友人と対戦）:</p>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="invite-code-input" placeholder="招待コードを入力" style="flex: 1; padding: 8px; border-radius: 4px; border: 1px solid #8b5a2b;">
                            <button class="btn btn-secondary" onclick="joinWithCode()">参加</button>
                        </div>
                        <button class="btn btn-primary" onclick="generateInviteCode()" style="margin-top: 10px; width: 100%;">招待コードを生成</button>
                    </div>
                </div>
                <div class="modal-buttons">
                    <button class="btn btn-secondary" onclick="hideModal('online-match-modal'); showModal('mode-modal')">戻る</button>
                </div>
            </div>
        </div>

        <!-- マッチメイキング中モーダル -->
        <div id="matchmaking-modal" class="modal hidden">
            <div class="modal-content">
                <h2>対戦相手を探中...</h2>
                <div style="text-align: center; margin: 30px 0;">
                    <div class="thinking-spinner" style="margin: 0 auto 20px;"></div>
                    <p id="matchmaking-status">マッチメイキング中...</p>
                </div>
                <div class="modal-buttons">
                    <button class="btn btn-secondary" onclick="cancelMatchmaking()">キャンセル</button>
                </div>
            </div>
        </div>

        <!-- 成り確認モーダル -->
        <div id="promote-modal" class="modal hidden">
            <div class="modal-content promote-content">
                <h2>成りますか？</h2>
                <div class="promote-options">
                    <button id="promote-yes" class="btn btn-primary promote-btn">
                        <span class="promote-piece" id="promoted-piece"></span>
                        <span>成る</span>
                    </button>
                    <button id="promote-no" class="btn btn-secondary promote-btn">
                        <span class="promote-piece" id="unpromoted-piece"></span>
                        <span>成らない</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- 勝敗モーダル -->
        <div id="result-modal" class="modal hidden">
            <div class="modal-content result-content">
                <h2 id="result-title">🎉 勝利！</h2>
                <div class="result-details">
                    <p id="result-message"></p>
                    <p class="result-moves">手数: <span id="result-move-count">0</span>手</p>
                </div>
                <div class="modal-buttons">
                    <button id="play-again-btn" class="btn btn-primary">もう一度対局</button>
                    <button id="change-mode-btn" class="btn btn-secondary">モード変更</button>
                </div>
            </div>
        </div>

        <!-- 詰将棋クリアモーダル -->
        <div id="tsume-clear-modal" class="modal hidden">
            <div class="modal-content result-content">
                <h2 id="tsume-result-title">🎉 正解！</h2>
                <div class="result-details">
                    <p id="tsume-message">見事、詰みました！</p>
                </div>
                <div class="modal-buttons">
                    <button id="next-tsume-btn" class="btn btn-primary">次の問題</button>
                    <button id="tsume-menu-btn" class="btn btn-secondary">問題選択</button>
                </div>
            </div>
        </div>
    </div>

    <script src="game.js"></script>
</body>
</html>
